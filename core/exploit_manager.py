import json
from pathlib import Path

class ExploitManager:
    def __init__(self, db_path="data/exploits.json"):
        self.db_path = Path(db_path)
        self.exploits = self._load_db()

    def _load_db(self):
        if self.db_path.exists():
            return json.loads(self.db_path.read_text())
        return {
            "windows": [
                {"name": "Follina (CVE-2022-30190)", "module": "exploit/windows/misc/msdt_follina", "reliability": "high"},
                {"name": "PrintNightmare", "module": "exploit/windows/dcerpc/cve_2021_1675_printnightmare", "reliability": "high"},
                {"name": "SMBGhost", "module": "exploit/windows/smb/cve_2020_0796_smbghost", "reliability": "high"}
            ],
            "linux": [
                {"name": "Dirty Pipe (CVE-2022-0847)", "module": "exploit/linux/local/cve_2022_0847_dirtypipe", "reliability": "excellent"},
                {"name": "PwnKit (CVE-2021-4034)", "module": "exploit/linux/local/cve_2021_4034_pwnkit_lpe_pkexec", "reliability": "excellent"}
            ],
            "android": [
                {"name": "ADB Remote Execution", "module": "exploit/android/adb/adb_remote_exec", "reliability": "high"}
            ]
        }

    def get_best_exploit(self, os_name):
        return self.exploits.get(os_name.lower(), [])

    def save_db(self):
        self.db_path.parent.mkdir(parents=True, exist_ok=True)
        self.db_path.write_text(json.dumps(self.exploits, indent=4))
